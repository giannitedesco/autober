#!/usr/bin/python

import autober
from sys import stdout,argv

if __name__ == '__main__':
	for x in argv[1:]:
		lex = autober.lexer(open(x))
		parser = autober.parser(lex)
		p = parser.parse_tree()
		ast = autober.semantics(p)
		ast.parse_tree.pretty_print()

		target = autober.target.c(ast)
		h_file = "auto_" + target.modname + ".h"
		c_file = "auto_" + target.modname + ".c"
		h = open(h_file, 'w')
		#h = stdout
		target.write_header(h)
		c = open(c_file, 'w')
		#c = stdout
		target.include(h_file)
		target.write_code(c)
